{"ast":null,"code":"/* This code is based on:\nzousan - A Lightning Fast, Yet Very Small Promise A+ Compliant Implementation\nhttps://github.com/bluejava/zousan\nAuthor: Glenn Crownover <glenn@bluejava.com> (http://www.bluejava.com)\nVersion 2.3.3\nLicense: MIT */\n\"use strict\";\n\nmodule.exports = function (tick) {\n  tick = tick || typeof process === \"object\" && process.nextTick || typeof setImmediate === \"function\" && setImmediate || function (f) {\n    setTimeout(f, 0);\n  };\n\n  var soon = function () {\n    var fq = [],\n        fqStart = 0,\n        bufferSize = 1024;\n\n    function callQueue() {\n      while (fq.length - fqStart) {\n        try {\n          fq[fqStart]();\n        } catch (ex) {\n          /* console.error(ex) */\n        }\n\n        fq[fqStart++] = undefined;\n\n        if (fqStart === bufferSize) {\n          fq.splice(0, bufferSize);\n          fqStart = 0;\n        }\n      }\n    }\n\n    return function (fn) {\n      fq.push(fn);\n      if (fq.length - fqStart === 1) tick(callQueue);\n    };\n  }();\n\n  function Zousan(func) {\n    if (func) {\n      var me = this;\n      func(function (arg) {\n        me.resolve(arg);\n      }, function (arg) {\n        me.reject(arg);\n      });\n    }\n  }\n\n  Zousan.prototype = {\n    resolve: function (value) {\n      if (this.state !== undefined) return;\n      if (value === this) return this.reject(new TypeError(\"Attempt to resolve promise with self\"));\n      var me = this;\n\n      if (value && (typeof value === \"function\" || typeof value === \"object\")) {\n        try {\n          var first = 0;\n          var then = value.then;\n\n          if (typeof then === \"function\") {\n            then.call(value, function (ra) {\n              if (!first++) {\n                me.resolve(ra);\n              }\n            }, function (rr) {\n              if (!first++) {\n                me.reject(rr);\n              }\n            });\n            return;\n          }\n        } catch (e) {\n          if (!first) this.reject(e);\n          return;\n        }\n      }\n\n      this.state = STATE_FULFILLED;\n      this.v = value;\n      if (me.c) soon(function () {\n        for (var n = 0, l = me.c.length; n < l; n++) STATE_FULFILLED(me.c[n], value);\n      });\n    },\n    reject: function (reason) {\n      if (this.state !== undefined) return;\n      this.state = STATE_REJECTED;\n      this.v = reason;\n      var clients = this.c;\n      if (clients) soon(function () {\n        for (var n = 0, l = clients.length; n < l; n++) STATE_REJECTED(clients[n], reason);\n      });\n    },\n    then: function (onF, onR) {\n      var p = new Zousan();\n      var client = {\n        y: onF,\n        n: onR,\n        p: p\n      };\n\n      if (this.state === undefined) {\n        if (this.c) this.c.push(client);else this.c = [client];\n      } else {\n        var s = this.state,\n            a = this.v;\n        soon(function () {\n          s(client, a);\n        });\n      }\n\n      return p;\n    }\n  };\n\n  function STATE_FULFILLED(c, arg) {\n    if (typeof c.y === \"function\") {\n      try {\n        var yret = c.y.call(undefined, arg);\n        c.p.resolve(yret);\n      } catch (err) {\n        c.p.reject(err);\n      }\n    } else c.p.resolve(arg);\n  }\n\n  function STATE_REJECTED(c, reason) {\n    if (typeof c.n === \"function\") {\n      try {\n        var yret = c.n.call(undefined, reason);\n        c.p.resolve(yret);\n      } catch (err) {\n        c.p.reject(err);\n      }\n    } else c.p.reject(reason);\n  }\n\n  Zousan.resolve = function (val) {\n    if (val && val instanceof Zousan) return val;\n    var z = new Zousan();\n    z.resolve(val);\n    return z;\n  };\n\n  Zousan.reject = function (err) {\n    if (err && err instanceof Zousan) return err;\n    var z = new Zousan();\n    z.reject(err);\n    return z;\n  };\n\n  Zousan.version = \"2.3.3-nodent\";\n  return Zousan;\n};","map":{"version":3,"sources":["/home/thomas/Map-interactive/node_modules/nodent-runtime/zousan.js"],"names":["module","exports","tick","process","nextTick","setImmediate","f","setTimeout","soon","fq","fqStart","bufferSize","callQueue","length","ex","undefined","splice","fn","push","Zousan","func","me","arg","resolve","reject","prototype","value","state","TypeError","first","then","call","ra","rr","e","STATE_FULFILLED","v","c","n","l","reason","STATE_REJECTED","clients","onF","onR","p","client","y","s","a","yret","err","val","z","version"],"mappings":"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","sourcesContent":["/* This code is based on:\nzousan - A Lightning Fast, Yet Very Small Promise A+ Compliant Implementation\nhttps://github.com/bluejava/zousan\nAuthor: Glenn Crownover <glenn@bluejava.com> (http://www.bluejava.com)\nVersion 2.3.3\nLicense: MIT */\n\"use strict\";\nmodule.exports = function(tick){\n    tick = tick || (typeof process===\"object\" && process.nextTick) || (typeof setImmediate===\"function\" && setImmediate) || function(f){setTimeout(f,0)};\n    var soon = (function () {\n        var fq = [], fqStart = 0, bufferSize = 1024;\n        function callQueue() {\n            while (fq.length - fqStart) {\n                try { fq[fqStart]() } catch(ex) { /* console.error(ex) */ }\n                fq[fqStart++] = undefined;\n                if (fqStart === bufferSize) {\n                    fq.splice(0, bufferSize);\n                    fqStart = 0;\n                }\n            }\n        }\n\n        return function (fn) {\n            fq.push(fn);\n            if (fq.length - fqStart === 1)\n                tick(callQueue);\n        };\n    })();\n\n    function Zousan(func) {\n        if (func) {\n            var me = this;\n            func(function (arg) {\n                me.resolve(arg);\n            }, function (arg) {\n                me.reject(arg);\n            });\n        }\n    }\n\n    Zousan.prototype = {\n        resolve: function (value) {\n            if (this.state !== undefined)\n                return;\n            if (value === this)\n                return this.reject(new TypeError(\"Attempt to resolve promise with self\"));\n            var me = this;\n            if (value && (typeof value === \"function\" || typeof value === \"object\")) {\n                try {\n                    var first = 0;\n                    var then = value.then;\n                    if (typeof then === \"function\") {\n                        then.call(value, function (ra) {\n                            if (!first++) {\n                                me.resolve(ra);\n                            }\n                        }, function (rr) {\n                            if (!first++) {\n                                me.reject(rr);\n                            }\n                        });\n                        return;\n                    }\n                } catch (e) {\n                    if (!first)\n                        this.reject(e);\n                    return;\n                }\n            }\n            this.state = STATE_FULFILLED;\n            this.v = value;\n            if (me.c)\n                soon(function () {\n                    for (var n = 0, l = me.c.length;n < l; n++)\n                        STATE_FULFILLED(me.c[n], value);\n                });\n        },\n        reject: function (reason) {\n            if (this.state !== undefined)\n                return;\n            this.state = STATE_REJECTED;\n            this.v = reason;\n            var clients = this.c;\n            if (clients)\n                soon(function () {\n                    for (var n = 0, l = clients.length;n < l; n++)\n                        STATE_REJECTED(clients[n], reason);\n                });\n        },\n        then: function (onF, onR) {\n            var p = new Zousan();\n            var client = {\n                y: onF,\n                n: onR,\n                p: p\n            };\n            if (this.state === undefined) {\n                if (this.c)\n                    this.c.push(client);\n                else\n                    this.c = [client];\n            } else {\n                var s = this.state, a = this.v;\n                soon(function () {\n                    s(client, a);\n                });\n            }\n            return p;\n        }\n    };\n\n    function STATE_FULFILLED(c, arg) {\n        if (typeof c.y === \"function\") {\n            try {\n                var yret = c.y.call(undefined, arg);\n                c.p.resolve(yret);\n            } catch (err) {\n                c.p.reject(err);\n            }\n        } else\n            c.p.resolve(arg);\n    }\n\n    function STATE_REJECTED(c, reason) {\n        if (typeof c.n === \"function\") {\n            try {\n                var yret = c.n.call(undefined, reason);\n                c.p.resolve(yret);\n            } catch (err) {\n                c.p.reject(err);\n            }\n        } else\n            c.p.reject(reason);\n    }\n\n    Zousan.resolve = function (val) {\n        if (val && (val instanceof Zousan))\n            return val ;\n        var z = new Zousan();\n        z.resolve(val);\n        return z;\n    };\n    Zousan.reject = function (err) {\n        if (err && (err instanceof Zousan))\n            return err ;\n        var z = new Zousan();\n        z.reject(err);\n        return z;\n    };\n\n    Zousan.version = \"2.3.3-nodent\" ;\n    return Zousan ;\n};\n"]},"metadata":{},"sourceType":"script"}